:original_name: waf_01_0156.html

.. _waf_01_0156:

Querying a Protection Event
===========================

WAF sorts out the attacks, the ten websites attacked the most, ten attack source IP addresses that launched the most attacks, and the ten URLs attacked the most for a selected time range. You can view the blocked or logged events on the **Events** page. You can view details of events generated by WAF, including the occurrence time, attack source IP address, geographic location of the attack source IP address, malicious load, and hit rule for an event.

Constraints
-----------

-  On the WAF console, you can view the event data for all protected domain names over the last 30 days. You can authorize LTS to log WAF activities so that you can view attack and access logs and store all logs for a long time. For more details, see :ref:`Using LTS to Log WAF Activities <waf_01_0172>`.
-  If you switch the WAF working mode for a website to **Suspended**, WAF only forwards all requests to the website without inspection. It does not log any attack events neither.
-  If the security software installed on your server blocks the event file from being downloaded, close the software and download the file again.

Viewing Protection Event Logs
-----------------------------

#. Log in to the management console.

#. Click |image1| in the upper left corner of the management console and select a region or project.

#. Click |image2| in the upper left corner and choose **Web Application Firewall (Dedicated)** under **Security**.

#. In the navigation pane on the left, click **Events**.

#. Click the **Search** tab. In the website or instance drop-down list, select a website to view corresponding event logs. The query time can be **Yesterday**, **Today**, **Past 3 days**, **Past 7 days**, **Past 30 days**, or a time range you configure.

   -  **Events over Time**: displays the WAF protection status for the selected website within the selected time range.
   -  **Top Tens**: displays top 10 attacks, attacked websites, attack source IP addresses, and attacked URLs for a selected time range. You can click |image3| to copy the data in the corresponding chart.


   .. figure:: /_static/images/en-us_image_0000002210228712.png
      :alt: **Figure 1** Events

      **Figure 1** Events

#. In the **Events** area, view the event details.

   -  Configure a filter by combining several conditions. Then, click **OK**. Conditions will be displayed above the event list. :ref:`Table 2 <waf_01_0156__table56661142104614>` lists parameters for filter conditions.
   -  In the upper left corner of the event list, click **Export** to export events. If the number of events is less than 200, the events are exported to your local PC. If the number of events is greater than or equal to 200, the event record is displayed on the **Downloads** page. You can download the events on the **Downloads** page.
   -  Click |image4| to select fields you want to display in the event lists.
   -  Click **Details** in the **Operation** column of the target event to view details about the event. You can check the event overview, malicious payloads, request details, and response details.


   .. figure:: /_static/images/en-us_image_0000002210228768.png
      :alt: **Figure 2** Events

      **Figure 2** Events

   .. table:: **Table 1** Filter condition fields

      +-----------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Parameter                         | Description                                                                                                                                                                                                                                                                                                                                                                                                              |
      +===================================+==========================================================================================================================================================================================================================================================================================================================================================================================================================+
      | Source IP Address                 | Public IP address of the web visitor/attacker.                                                                                                                                                                                                                                                                                                                                                                           |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                          |
      |                                   | By default, **All** is selected. You can view logs of all attack source IP addresses, select an attack source IP address, or enter an attack source IP address to view corresponding attack logs.                                                                                                                                                                                                                        |
      +-----------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Rule ID                           | ID of a built-in protection rule in WAF basic web protection.                                                                                                                                                                                                                                                                                                                                                            |
      +-----------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | URL                               | Attacked URL.                                                                                                                                                                                                                                                                                                                                                                                                            |
      +-----------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Event Type                        | Type of the attack.                                                                                                                                                                                                                                                                                                                                                                                                      |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                          |
      |                                   | By default, **All** is selected. You can view logs of all attack types or select an attack type to view corresponding attack logs.                                                                                                                                                                                                                                                                                       |
      +-----------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Protective Action                 | The options are **Block**, **Log only**, **Verification code**, and **Mismatch**.                                                                                                                                                                                                                                                                                                                                        |
      |                                   |                                                                                                                                                                                                                                                                                                                                                                                                                          |
      |                                   | -  **Verification code**: In CC attack protection rules, you can set **Protective Action** to **Verification code**. If a visitor sends too many requests, with the request quantity exceeding the rate limit specified by the CC attack protection rule used, a message is displayed to ask the visitor to provide a verification code. Visitor's requests will be blocked unless they enter a valid verification code. |
      |                                   | -  **Mismatch**: If an access request matches a web tamper protection rule, information leakage prevention rule, or data masking rule, the protective action is marked as **Mismatch**.                                                                                                                                                                                                                                  |
      +-----------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
      | Event ID                          | ID of the event.                                                                                                                                                                                                                                                                                                                                                                                                         |
      +-----------------------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

   .. _waf_01_0156__table56661142104614:

   .. table:: **Table 2** Parameters in the event list

      +-----------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------+
      | Parameter             | Description                                                                                                                                                               | Example Value         |
      +=======================+===========================================================================================================================================================================+=======================+
      | Time                  | When the attack occurred.                                                                                                                                                 | 2021/02/04 13:20:04   |
      +-----------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------+
      | Source IP Address     | Public IP address of the web visitor/attacker.                                                                                                                            | ``-``                 |
      +-----------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------+
      | host                  | Attacked domain name.                                                                                                                                                     | www.example.com       |
      +-----------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------+
      | Rule ID               | ID of a built-in protection rule in WAF basic web protection.                                                                                                             | ``-``                 |
      +-----------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------+
      | URL                   | Attacked URL.                                                                                                                                                             | /admin                |
      +-----------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------+
      | Event Type            | Type of attack.                                                                                                                                                           | SQL injection         |
      +-----------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------+
      | Protective Action     | Protective actions configured in the rule. The options are **Block**, **Log only**, and **Verification code**.                                                            | Block                 |
      |                       |                                                                                                                                                                           |                       |
      |                       | .. note::                                                                                                                                                                 |                       |
      |                       |                                                                                                                                                                           |                       |
      |                       |    If an access request matches a web tamper protection rule, information leakage prevention rule, or data masking rule, the protective action is marked as **Mismatch**. |                       |
      +-----------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------+
      | Status Code           | HTTP status code returned on the block page.                                                                                                                              | 418                   |
      +-----------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------+
      | Malicious Load        | Location or part of the attack that causes damage or the number of times that the URL was accessed.                                                                       | id=1 and 1='1         |
      |                       |                                                                                                                                                                           |                       |
      |                       | .. note::                                                                                                                                                                 |                       |
      |                       |                                                                                                                                                                           |                       |
      |                       |    -  In a CC attack, the malicious load indicates the number of times that the URL was accessed.                                                                         |                       |
      |                       |    -  For blacklist protection events, the malicious load is left blank.                                                                                                  |                       |
      +-----------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------+
      | Enterprise Project    | Enterprise project your websites belong to.                                                                                                                               | default               |
      +-----------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------+

.. |image1| image:: /_static/images/en-us_image_0000002194533712.jpg
.. |image2| image:: /_static/images/en-us_image_0000002194070596.png
.. |image3| image:: /_static/images/en-us_image_0000002210068928.png
.. |image4| image:: /_static/images/en-us_image_0000002245108909.png
